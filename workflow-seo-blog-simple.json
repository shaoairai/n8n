{
  "name": "SEO Blog Publisher (ç°¡åŒ–ç‰ˆ)",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "seo-blog",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "node-webhook",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [200, 300],
      "webhookId": "seo-blog-simple"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.anthropic.com/v1/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "x-api-key", "value": "={{ $env.ANTHROPIC_API_KEY }}" },
            { "name": "anthropic-version", "value": "2023-06-01" },
            { "name": "content-type", "value": "application/json" }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"claude-3-haiku-20240307\",\n  \"max_tokens\": 4096,\n  \"messages\": [{\n    \"role\": \"user\",\n    \"content\": \"ä½ æ˜¯ SEO éƒ¨è½æ ¼å¯«æ‰‹ã€‚æ ¹æ“šä»¥ä¸‹è³‡è¨Šç”¢å‡ºç¹é«”ä¸­æ–‡æ–‡ç« ï¼š\\n\\né—œéµå­—ï¼š{{ $json.body.keyword }}\\næ–¹å‘ï¼š{{ $json.body.direction }}\\nç¶“æ­·ï¼š{{ $json.body.experience || 'ç„¡' }}\\n\\nè«‹è¼¸å‡º JSON æ ¼å¼ï¼ˆä¸è¦å…¶ä»–æ–‡å­—ï¼‰ï¼š\\n{\\n  \\\"title\\\": \\\"æ¨™é¡Œå«é—œéµå­—\\\",\\n  \\\"slug\\\": \\\"english-slug\\\",\\n  \\\"excerpt\\\": \\\"æ‘˜è¦100å­—\\\",\\n  \\\"content\\\": \\\"å®Œæ•´ HTML æ–‡ç« \\\",\\n  \\\"fb_post\\\": \\\"FBè²¼æ–‡150å­—å«emoji\\\",\\n  \\\"ig_post\\\": \\\"IGè²¼æ–‡200å­—å«emojiå’Œhashtags\\\",\\n  \\\"image_prompt\\\": \\\"è‹±æ–‡åœ–ç‰‡æè¿°prompt\\\"\\n}\"\n  }]\n}",
        "options": { "timeout": 120000 }
      },
      "id": "node-ai-generate",
      "name": "AI ç”¢æ–‡",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [420, 300]
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json;\nconst text = response.content[0].text.replace(/```json\\n?/g, '').replace(/```/g, '').trim();\nconst article = JSON.parse(text);\n\nreturn {\n  json: {\n    ...article,\n    keyword: $('Webhook').first().json.body.keyword,\n    publish_now: $('Webhook').first().json.body.publish_now || false\n  }\n};"
      },
      "id": "node-parse",
      "name": "è§£ææ–‡ç« ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [640, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $env.WP_BASE_URL }}/wp-json/wp/v2/posts",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"title\": {{ JSON.stringify($json.title) }},\n  \"slug\": {{ JSON.stringify($json.slug) }},\n  \"content\": {{ JSON.stringify($json.content) }},\n  \"excerpt\": {{ JSON.stringify($json.excerpt) }},\n  \"status\": \"{{ $json.publish_now ? 'publish' : 'draft' }}\"\n}",
        "options": {}
      },
      "id": "node-wp-post",
      "name": "ç™¼ WordPress",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [860, 300],
      "credentials": {
        "httpBasicAuth": {
          "id": "wp-auth",
          "name": "WordPress Auth"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const wpResult = $input.first().json;\nconst article = $('è§£ææ–‡ç« ').first().json;\n\nreturn {\n  json: {\n    ...article,\n    wp_id: wpResult.id,\n    wp_url: wpResult.link || wpResult.guid?.rendered\n  }\n};"
      },
      "id": "node-merge-wp",
      "name": "åˆä½µWPçµæœ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1080, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v18.0/{{ $env.META_PAGE_ID }}/feed",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            { "name": "access_token", "value": "={{ $env.META_ACCESS_TOKEN }}" },
            { "name": "message", "value": "={{ $json.fb_post }}\\n\\nğŸ”— {{ $json.wp_url }}" }
          ]
        },
        "options": {}
      },
      "id": "node-fb-post",
      "name": "ç™¼ Facebook",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1300, 300],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const fbResult = $input.first().json;\nconst prev = $('åˆä½µWPçµæœ').first().json;\n\nreturn {\n  json: {\n    ...prev,\n    fb_id: fbResult.id || null,\n    fb_error: fbResult.error?.message || null\n  }\n};"
      },
      "id": "node-merge-fb",
      "name": "åˆä½µFBçµæœ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1520, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "=https://image.pollinations.ai/prompt/{{ encodeURIComponent($json.image_prompt + ', instagram post, square 1080x1080, modern design') }}?width=1080&height=1080&nologo=true",
        "options": {
          "response": { "response": { "responseFormat": "file" } },
          "timeout": 60000
        }
      },
      "id": "node-generate-image",
      "name": "AI ç”¢åœ–",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1740, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $env.WP_BASE_URL }}/wp-json/wp/v2/media",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "Content-Disposition", "value": "attachment; filename=\"ig-post.png\"" }
          ]
        },
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {}
      },
      "id": "node-upload-image",
      "name": "ä¸Šå‚³åœ–åˆ°WP",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1960, 300],
      "credentials": {
        "httpBasicAuth": {
          "id": "wp-auth",
          "name": "WordPress Auth"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const uploadResult = $input.first().json;\nconst prev = $('åˆä½µFBçµæœ').first().json;\n\nreturn {\n  json: {\n    ...prev,\n    image_url: uploadResult.source_url || uploadResult.guid?.rendered\n  }\n};"
      },
      "id": "node-merge-image",
      "name": "åˆä½µåœ–ç‰‡URL",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2180, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v18.0/{{ $env.META_IG_USER_ID }}/media",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            { "name": "access_token", "value": "={{ $env.META_ACCESS_TOKEN }}" },
            { "name": "image_url", "value": "={{ $json.image_url }}" },
            { "name": "caption", "value": "={{ $json.ig_post }}" }
          ]
        },
        "options": {}
      },
      "id": "node-ig-container",
      "name": "IG å»ºç«‹å®¹å™¨",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2400, 300],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 30,
        "unit": "seconds"
      },
      "id": "node-wait",
      "name": "ç­‰å¾…30ç§’",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [2620, 300],
      "webhookId": "ig-wait"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v18.0/{{ $env.META_IG_USER_ID }}/media_publish",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            { "name": "access_token", "value": "={{ $env.META_ACCESS_TOKEN }}" },
            { "name": "creation_id", "value": "={{ $('IG å»ºç«‹å®¹å™¨').first().json.id }}" }
          ]
        },
        "options": {}
      },
      "id": "node-ig-publish",
      "name": "IG ç™¼å¸ƒ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2840, 300],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const igResult = $input.first().json;\nconst prev = $('åˆä½µåœ–ç‰‡URL').first().json;\n\nconst result = {\n  status: 'completed',\n  article_title: prev.title,\n  keyword: prev.keyword,\n  wordpress: {\n    id: prev.wp_id,\n    url: prev.wp_url\n  },\n  facebook: {\n    id: prev.fb_id,\n    error: prev.fb_error\n  },\n  instagram: {\n    id: igResult.id || null,\n    error: igResult.error?.message || null,\n    image_url: prev.image_url\n  }\n};\n\nreturn { json: result };"
      },
      "id": "node-summary",
      "name": "è¼¸å‡ºçµæœ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3060, 300]
    },
    {
      "parameters": {
        "sendTo": "={{ $env.NOTIFY_EMAIL }}",
        "subject": "=âœ… SEO æ–‡ç« ç™¼å¸ƒæˆåŠŸï¼š{{ $json.article_title }}",
        "emailType": "html",
        "message": "=<h2>SEO æ–‡ç« è‡ªå‹•ç™¼å¸ƒå®Œæˆ</h2>\n<p><strong>æ–‡ç« æ¨™é¡Œï¼š</strong>{{ $json.article_title }}</p>\n<p><strong>é—œéµå­—ï¼š</strong>{{ $json.keyword }}</p>\n<hr>\n<h3>ç™¼å¸ƒçµæœ</h3>\n<table border=\"1\" cellpadding=\"8\" cellspacing=\"0\">\n  <tr><td><strong>WordPress</strong></td><td>{{ $json.wordpress.url ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—' }}</td><td><a href=\"{{ $json.wordpress.url }}\">{{ $json.wordpress.url }}</a></td></tr>\n  <tr><td><strong>Facebook</strong></td><td>{{ $json.facebook.id ? 'âœ… æˆåŠŸ' : 'âŒ ' + ($json.facebook.error || 'å¤±æ•—') }}</td><td>Post ID: {{ $json.facebook.id || 'N/A' }}</td></tr>\n  <tr><td><strong>Instagram</strong></td><td>{{ $json.instagram.id ? 'âœ… æˆåŠŸ' : 'âŒ ' + ($json.instagram.error || 'å¤±æ•—') }}</td><td>Media ID: {{ $json.instagram.id || 'N/A' }}</td></tr>\n</table>\n<hr>\n<p><small>ç”± n8n SEO Blog Publisher è‡ªå‹•ç™¼é€</small></p>",
        "options": {}
      },
      "id": "node-send-email",
      "name": "ç™¼é€ Email é€šçŸ¥",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [3280, 300],
      "credentials": {
        "smtp": {
          "id": "smtp-credential",
          "name": "SMTP"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $('è¼¸å‡ºçµæœ').first().json }}",
        "options": {}
      },
      "id": "node-respond",
      "name": "å›å‚³çµæœ",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [3500, 300]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [[{ "node": "AI ç”¢æ–‡", "type": "main", "index": 0 }]]
    },
    "AI ç”¢æ–‡": {
      "main": [[{ "node": "è§£ææ–‡ç« ", "type": "main", "index": 0 }]]
    },
    "è§£ææ–‡ç« ": {
      "main": [[{ "node": "ç™¼ WordPress", "type": "main", "index": 0 }]]
    },
    "ç™¼ WordPress": {
      "main": [[{ "node": "åˆä½µWPçµæœ", "type": "main", "index": 0 }]]
    },
    "åˆä½µWPçµæœ": {
      "main": [[{ "node": "ç™¼ Facebook", "type": "main", "index": 0 }]]
    },
    "ç™¼ Facebook": {
      "main": [
        [{ "node": "åˆä½µFBçµæœ", "type": "main", "index": 0 }],
        [{ "node": "åˆä½µFBçµæœ", "type": "main", "index": 0 }]
      ]
    },
    "åˆä½µFBçµæœ": {
      "main": [[{ "node": "AI ç”¢åœ–", "type": "main", "index": 0 }]]
    },
    "AI ç”¢åœ–": {
      "main": [[{ "node": "ä¸Šå‚³åœ–åˆ°WP", "type": "main", "index": 0 }]]
    },
    "ä¸Šå‚³åœ–åˆ°WP": {
      "main": [[{ "node": "åˆä½µåœ–ç‰‡URL", "type": "main", "index": 0 }]]
    },
    "åˆä½µåœ–ç‰‡URL": {
      "main": [[{ "node": "IG å»ºç«‹å®¹å™¨", "type": "main", "index": 0 }]]
    },
    "IG å»ºç«‹å®¹å™¨": {
      "main": [
        [{ "node": "ç­‰å¾…30ç§’", "type": "main", "index": 0 }],
        [{ "node": "è¼¸å‡ºçµæœ", "type": "main", "index": 0 }]
      ]
    },
    "ç­‰å¾…30ç§’": {
      "main": [[{ "node": "IG ç™¼å¸ƒ", "type": "main", "index": 0 }]]
    },
    "IG ç™¼å¸ƒ": {
      "main": [
        [{ "node": "è¼¸å‡ºçµæœ", "type": "main", "index": 0 }],
        [{ "node": "è¼¸å‡ºçµæœ", "type": "main", "index": 0 }]
      ]
    },
    "è¼¸å‡ºçµæœ": {
      "main": [[{ "node": "ç™¼é€ Email é€šçŸ¥", "type": "main", "index": 0 }]]
    },
    "ç™¼é€ Email é€šçŸ¥": {
      "main": [[{ "node": "å›å‚³çµæœ", "type": "main", "index": 0 }]]
    }
  },
  "settings": { "executionOrder": "v1" }
}
